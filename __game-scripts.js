var game,Movement=pc.createScript("movement");Movement.attributes.add("camera",{type:"entity"}),Movement.attributes.add("active_cubeMaterial",{type:"asset",assettype:"material"}),Movement.attributes.add("cubesMaterial",{type:"asset",assettype:"material"});var paused,cube_1,cube_2,cube_3,active_cube,i,j,isTranslating=!1,stopTranslating=!1,entities=[],cubes=[],left_pos=new pc.Vec3(-.3,1.5,0),center_pos=new pc.Vec3(0,1.5,0),right_pos=new pc.Vec3(.3,1.5,0);Movement.prototype.initialize=function(){paused=!0,this.selected=!1,game=this.app.root.findByName("Root"),this.app.on("game:start",(function(){paused=!1,this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onSelect,this)}),this),this.app.on("game:gameover",(function(){paused=!0,this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onSelect,this)}),this),this.app.on("game:victory",(function(){paused=!0,this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onSelect,this)}),this),this.app.on("game:reset",(function(){active_cube.tags.remove("selected"),this.selected=!1,i=0,j=0,stopTranslating=!1}),this),cube_1=this.entity.findByName("cube_1"),cube_2=this.entity.findByName("cube_2"),cube_3=this.entity.findByName("cube_3"),cubes.push(cube_1,cube_2,cube_3),i=0,j=0},Movement.prototype.update=function(e){paused||(this.selected||((active_cube=this.getRandom_items(cubes)[0]).model.meshInstances[0].material=this.active_cubeMaterial.resource,active_cube.tags.add("selected"),console.log(active_cube.tags),this.selected=!0),120==j?(active_cube.model.meshInstances[0].material=this.cubesMaterial.resource,900!=i&&(i++,isTranslating||(entities=this.getRandom_items(cubes))),this.swap_cubes(entities[0],entities[1])):j++)},Movement.prototype.getRandom_items=function(e){var t=e.sort((function(){return.5-Math.random()})).slice(0,2);return result=[],result.push(t[0],t[1]),result},Movement.prototype.swap_cubes=function(e,t){stopTranslating||("cube_1"==e.name&&"cube_2"==t.name?(isTranslating=!0,e.getLocalPosition().x<(left_pos.x+center_pos.x)/2&&t.getLocalPosition().x>(left_pos.x+center_pos.x)/2?(e.translateLocal(.01,0,-.01),t.translateLocal(-.01,0,.01)):e.getLocalPosition().x<center_pos.x&&t.getLocalPosition().x>left_pos.x?(e.translateLocal(.01,0,.01),t.translateLocal(-.01,0,-.01)):(e.setLocalPosition(center_pos),t.setLocalPosition(left_pos),e.name="cube_2",t.name="cube_1",isTranslating=!1,900==i&&(stopTranslating=!0))):"cube_2"==e.name&&"cube_1"==t.name?this.swap_cubes(t,e):"cube_1"==e.name&&"cube_3"==t.name?(isTranslating=!0,e.getLocalPosition().x<(left_pos.x+right_pos.x)/2&&t.getLocalPosition().x>(left_pos.x+right_pos.x)/2?(e.translateLocal(.01,0,-.01),t.translateLocal(-.01,0,.01)):e.getLocalPosition().x<right_pos.x&&t.getLocalPosition().x>left_pos.x?(e.translateLocal(.01,0,.01),t.translateLocal(-.01,0,-.01)):(e.setLocalPosition(right_pos),t.setLocalPosition(left_pos),e.name="cube_3",t.name="cube_1",isTranslating=!1,900==i&&(stopTranslating=!0))):"cube_3"==e.name&&"cube_1"==t.name?this.swap_cubes(t,e):"cube_2"==e.name&&"cube_3"==t.name?(isTranslating=!0,e.getLocalPosition().x<(right_pos.x+center_pos.x)/2&&t.getLocalPosition().x>(right_pos.x+center_pos.x)/2?(e.translateLocal(.01,0,-.01),t.translateLocal(-.01,0,.01)):e.getLocalPosition().x<right_pos.x&&t.getLocalPosition().x>center_pos.x?(e.translateLocal(.01,0,.01),t.translateLocal(-.01,0,-.01)):(e.setLocalPosition(right_pos),t.setLocalPosition(center_pos),e.name="cube_3",t.name="cube_2",isTranslating=!1,900==i&&(stopTranslating=!0))):"cube_3"==e.name&&"cube_2"==t.name&&this.swap_cubes(t,e))},Movement.prototype.onSelect=function(e){if(stopTranslating&&!paused){var t=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.nearClip),a=this.camera.camera.screenToWorld(e.x,e.y,this.camera.camera.farClip);this.app.systems.rigidbody.raycastFirst(t,a,(function(e){e.entity.tags.has("selected")?game.script.game.victory():game.script.game.gameOver()}))}};var Game=pc.createScript("game");Game.attributes.add("uiMenu",{type:"entity"}),Game.attributes.add("uiGameOver",{type:"entity"}),Game.attributes.add("uiVictory",{type:"entity"}),Game.STATE_MENU="menu",Game.STATE_INGAME="ingame",Game.STATE_GAMEOVER="gameover",Game.STATE_VICTORY="victory",Game.prototype.initialize=function(){this.state=Game.STATE_MENU,this.setResolution(),window.addEventListener("orientationchange",this.setResolution.bind(this)),this.app.on("ui:start",this.start,this),this.app.on("ui:reset",this.reset,this)},Game.prototype.update=function(t){},Game.prototype.setResolution=function(){var t=window.screen.width,e=window.screen.height,a=this.entity.findByName("ground_Box"),i=this.entity.findByName("UI");t<640?(i.setLocalScale(.5,.5,.5),i.forEach((function(t){t.tags.has("text")&&(t.element.fontSize=16)})),a&&(a.setLocalScale(8,1,8),a.setLocalPosition(a.getLocalPosition().x,a.getLocalPosition().y,6)),a.forEach((function(t){t.tags.has("cube")&&t.setLocalScale(.08,1,.08)})),this.app.setCanvasResolution(pc.RESOLUTION_AUTO,t,e),this.app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW)):(i.setLocalScale(1,1,1),i.forEach((function(t){t.tags.has("text")&&(t.element.fontSize=29)})),a&&(a.setLocalScale(30,1,20),a.setLocalPosition(a.getLocalPosition().x,a.getLocalPosition().y,0)),a.forEach((function(t){t.tags.has("cube")&&t.setLocalScale(.06,2,.1)})))},Game.prototype.start=function(){this.state=Game.STATE_INGAME,this.app.fire("game:start"),this.uiMenu.enabled=!1},Game.prototype.gameOver=function(){this.state=Game.STATE_GAMEOVER,this.app.fire("game:gameover"),this.uiGameOver.enabled=!0},Game.prototype.victory=function(){this.state=Game.STATE_VICTORY,this.app.fire("game:victory"),this.uiVictory.enabled=!0},Game.prototype.reset=function(){this.state=Game.STATE_MENU,this.app.fire("game:reset"),this.uiGameOver.enabled=!1,this.uiVictory.enabled=!1,this.uiMenu.enabled=!0};var UiMenu=pc.createScript("uiMenu");UiMenu.prototype.initialize=function(){this.onClick()},UiMenu.prototype.onClick=function(){this.entity.findByName("Button").element.on("click",this.start,this)},UiMenu.prototype.start=function(t){this.app.fire("ui:start"),t.stopPropagation()};var BtnStates=pc.createScript("btnStates");BtnStates.prototype.initialize=function(){this.entity.element.on("mouseenter",this.onEnter,this),this.entity.element.on("mouseleave",this.onLeave,this)},BtnStates.prototype.onEnter=function(t){document.body.style.cursor="pointer"},BtnStates.prototype.onLeave=function(t){document.body.style.cursor="default"};var UiGameover=pc.createScript("uiGameover");UiGameover.prototype.initialize=function(){this.onClick()},UiGameover.prototype.onClick=function(){this.entity.findByName("Button").element.on("click",this.reset,this)},UiGameover.prototype.reset=function(e){this.app.fire("ui:reset"),e.stopPropagation()};var UiVictory=pc.createScript("uiVictory");UiVictory.prototype.initialize=function(){this.onClick()},UiVictory.prototype.onClick=function(){this.entity.findByName("Button").element.on("click",this.reset,this)},UiVictory.prototype.reset=function(t){this.app.fire("ui:reset"),t.stopPropagation()};var CubeStates=pc.createScript("cubeStates");CubeStates.attributes.add("camera",{type:"entity"}),CubeStates.worldPos=new pc.Vec3,CubeStates.prototype.initialize=function(){},CubeStates.prototype.update=function(t){this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseDown,this)},CubeStates.prototype.onEnter=function(t){document.body.style.cursor="pointer",console.log("aaa")},CubeStates.prototype.onLeave=function(t){document.body.style.cursor="default"},CubeStates.prototype.onTap=function(t,e){},CubeStates.prototype.onMouseDown=function(t){var e=this.camera.camera.screenToWorld(t.x,t.y,this.camera.camera.nearClip),o=this.camera.camera.screenToWorld(t.x,t.y,this.camera.camera.farClip);this.app.systems.rigidbody.raycastFirst(e,o,(function(t){t.entity.tags.has("cube")&&(document.body.style.cursor="pointer")})),document.body.style.cursor="default"};var Picker=pc.createScript("picker");Picker.prototype.initialize=function(){this.paused&&this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onSelect,this)},Picker.prototype.onSelect=function(t){var i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.nearClip),e=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip);this.app.systems.rigidbody.raycastFirst(i,e,(function(t){t.entity}))};